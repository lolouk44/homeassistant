- binary_sensor:
    - name: "Alert Outside Temp Sensor Lost"
      state: >-
        {{ (as_timestamp(now()) - as_timestamp(states.sensor.loft_temperature.last_updated ) | int > 3600 )}}

    - name: "Alert Upstairs Temp Sensor Lost"
      state: >-
        {{ (as_timestamp(now()) - as_timestamp(states.sensor.upstairs_temperature.last_updated ) | int > 14400 )}}

    - name: "Alert RAM Too High"
      state: >-
        {{ states("sensor.ram_usage")  | int > 90 }}

    - name: "Alert Home Disk Usage Too High"
      state: >-
        {{ states("sensor.home_disk_usage")  | int > 90 }}

    - name: "Alert Root Disk Usage Too High"
      state: >-
        {{ states("sensor.cctv2_root_disk_usage")  | int > 90 }}

    - name: "Alert CCTV2 Root Disk Usage Too High"
      state: >-
        {{ states("sensor.cctv2_root_disk_usage")  | int > 75 }}

    - name: "Alert CCTV2 NAS Disk Usage Too High"
      state: >-
        {{ states("sensor.cctv2_nas_disk_usage")  | int > 90 }}

    - name: "Alert Kitchen Freezer Temperature Too High"
      state: >-
        {{ states("sensor.kitchen_freezer_temperature")  | int > 0 }}

    - name: "Lolo Bedside Cabinet Lost"
      state: >-
        {{ states("light.lolo_bedside_light") == "unavailable" }}

    - name: "Lost Entities"
      state: '{{ states("sensor.lost_entities_count") | int(0)  > 0 }}'
      icon: 'mdi:eye'

- sensor:
    - name: "Lost Entities Ticker"
      state: >-
        {%- for state in states | selectattr('state','eq','unavailable') | rejectattr ('entity_id', 'in', ['media_player.as_aftka_cast','media_player.as_aftmm_cast'])-%}
        {% if (as_timestamp(now()) - as_timestamp(state.last_changed)) > 300 %}1{% endif %}
        {%- endfor -%}
      icon: 'mdi:eye'

    - name: "Lost Entities Count"
      state: '{{ states("sensor.lost_entities_ticker") | length }}'
      icon: 'mdi:eye'

    - name: "Lost Entities List"
      state: >-
        {%- for state in states | selectattr('state','eq','unavailable')  | rejectattr ('entity_id', 'in', ['media_player.as_aftka_cast','media_player.as_aftmm_cast'])%}
        - {% if (as_timestamp(now()) - as_timestamp(state.last_changed)) > 300 %}{{state.domain|title}}: {{state.attributes.friendly_name}} ({{state.entity_id}}){% endif %}
        {%- endfor -%}
      icon: 'mdi:eye'